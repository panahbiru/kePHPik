<?php
/**
    kePHPik Framework
    A buggy little flying framework

    Please check https://github.com/panahbiru/kephpik
    
    (c) 2015-2016 Luthfi Emka, SistemInformasi.biz
    License: GPLv2
**/
<?php
include "conf.php";require_once PATH.'vendor/autoload.php';@session_start();Class Core{ public function __construct(){$request=parse_uri($_SERVER['PATH_INFO']);$controller=ucfirst($request[0]);$method=$request[1];if(empty($controller))$controller='Home';if(empty($method))$method='index';if(file_exists(PATH.'controllers/'.$controller.'.php')){include PATH.'controllers/'.$controller.'.php';$this->$controller=new $controller;$cnt=count($request);if($cnt>1){unset($request[0]);unset($request[1]);if(method_exists($this->$controller,$method)){call_user_func_array(array($this->$controller,$method),$request);}else {die_("Methods not exists.");}}else{call_user_func(array($this->$controller,$method));}}else{die_("Controllers not exists.");}}}Class Controller{ public function __construct(){$this->session=new Session();} public function model($classname,$newmodelname=''){$class_name=ucfirst($classname);if(file_exists(PATH.'models/'.$class_name.'.php')){require_once PATH.'models/'.$class_name.'.php';$namamodel='Model'.$class_name;if(empty($newmodelname)){$this->$classname=new $namamodel;}else{$this->$newmodelname=new $namamodel;}}else{die_("Models not exists.");}} public function output($file,$data=''){if(file_exists(PATH.'views/'.$file.'.php')){if(!empty($data)){extract($data,EXTR_SKIP);}require_once PATH.'views/'.$file.'.php';}else{die_("View files not exists.");}} public function helper($name){if(file_exists(PATH.'helpers/'.$name.'.php')){require_once PATH.'helpers/'.$name.'.php';}else{die_("Helpers files not exists.");}}}Class Db{ public function __construct(){$__db=new ezSQL_mysqli(DBUSER,DBPASSWD,DBNAME,DBHOST);$this->db=$__db;}}Class Session{ public function setValue($name,$value=''){if(\is_array($name)){foreach($name AS $key=>$val)$_SESSION[$key]=$val;}else{$_SESSION[$name]=$value;}} public function getValue($name){if(isset($_SESSION[$name]))return $_SESSION[$name];else return false;} public function getAllValue(){if(isset($_SESSION)){return $_SESSION;}else{return false;}} public function deleteValue($name){unset($_SESSION[$name]);} public function destroy(){session_unset();session_destroy();}}function site_url(){global $CONFIG;return $CONFIG['site_url'];}function css_url(){global $CONFIG;return $CONFIG['css_url'];}function site_title(){global $CONFIG;return $CONFIG['site_title'];}function get_conf($key){global $CONFIG;return $CONFIG[$key];}function read_flatdb($table){$path=dirname(__FILE__).'/flatdb/';if(file_exists($path.$table.'.db')){$data=file_get_contents($path.$table.'.db');return $data;}else{return 'database not available';}}function parse_flatdb($table){$path=dirname(__FILE__).'/flatdb/';if(file_exists($path.$table.'.db')){$raw=file_get_contents($path.$table.'.db');$data=explode("\n",$raw);$cnt=count($data)-1;unset($data[$cnt]);return $data;}else{return 'database not available';}}function parse_uri($uri){$raw=explode("/",$uri);foreach($raw as $r){if(empty($r))continue;$hasil[]=$r;}return $hasil;}function redirect($num,$url){static $http=array(100=>"HTTP/1.1 100 Continue",101=>"HTTP/1.1 101 Switching Protocols",200=>"HTTP/1.1 200 OK",201=>"HTTP/1.1 201 Created",202=>"HTTP/1.1 202 Accepted",203=>"HTTP/1.1 203 Non-Authoritative Information",204=>"HTTP/1.1 204 No Content",205=>"HTTP/1.1 205 Reset Content",206=>"HTTP/1.1 206 Partial Content",300=>"HTTP/1.1 300 Multiple Choices",301=>"HTTP/1.1 301 Moved Permanently",302=>"HTTP/1.1 302 Found",303=>"HTTP/1.1 303 See Other",304=>"HTTP/1.1 304 Not Modified",305=>"HTTP/1.1 305 Use Proxy",307=>"HTTP/1.1 307 Temporary Redirect",400=>"HTTP/1.1 400 Bad Request",401=>"HTTP/1.1 401 Unauthorized",402=>"HTTP/1.1 402 Payment Required",403=>"HTTP/1.1 403 Forbidden",404=>"HTTP/1.1 404 Not Found",405=>"HTTP/1.1 405 Method Not Allowed",406=>"HTTP/1.1 406 Not Acceptable",407=>"HTTP/1.1 407 Proxy Authentication Required",408=>"HTTP/1.1 408 Request Time-out",409=>"HTTP/1.1 409 Conflict",410=>"HTTP/1.1 410 Gone",411=>"HTTP/1.1 411 Length Required",412=>"HTTP/1.1 412 Precondition Failed",413=>"HTTP/1.1 413 Request Entity Too Large",414=>"HTTP/1.1 414 Request-URI Too Large",415=>"HTTP/1.1 415 Unsupported Media Type",416=>"HTTP/1.1 416 Requested range not satisfiable",417=>"HTTP/1.1 417 Expectation Failed",500=>"HTTP/1.1 500 Internal Server Error",501=>"HTTP/1.1 501 Not Implemented",502=>"HTTP/1.1 502 Bad Gateway",503=>"HTTP/1.1 503 Service Unavailable",504=>"HTTP/1.1 504 Gateway Time-out");header($http[$num]);header("Location: $url");}function die_($messages,$custom_title='404 Page Not Found'){die('<!DOCTYPE html><html lang="en"><head><title>'.$custom_title.'</title><style type="text/css">::selection{background-color:#E13300;color:#fff}::moz-selection{background-color:#E13300;color:#fff}::webkit-selection{background-color:#E13300;color:#fff}body{background-color:#fff;margin:40px;font:13px/20px normal Helvetica,Arial,sans-serif;color:#4F5155}a{color:#039;background-color:transparent;font-weight:400}h1{color:#444;background-color:transparent;border-bottom:1px solid #D0D0D0;font-size:19px;font-weight:400;margin:0 0 14px;padding:14px 15px 10px}code{font-family:Consolas,Monaco,Courier New,Courier,monospace;font-size:12px;background-color:#f9f9f9;border:1px solid #D0D0D0;color:#002166;display:block;margin:14px 0;padding:12px 10px}#container{margin:10px;border:1px solid #D0D0D0;-webkit-box-shadow:0 0 8px #D0D0D0}p{margin:12px 15px}</style></head><body><div id="container"><h1>'.$custom_title.'</h1><p>'.$messages.'</p></div></body></html>
    ');}
